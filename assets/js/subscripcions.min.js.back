var data={csrf_toke:null,subscripcion:{tarifa:null,correo:null,telefono:null,metodoPago:null,boletin:null},grupo:null,usuarios:{},bigData:null};var userData={nombre:null,instrumento:null,foto:null,passaporte:null};class FormController{constructor(){this.submitElement=new SubmitElement(this);this.accordionPosition=0;this.accordions=[];this.init()}init(){let accordions=document.getElementsByClassName("accordion-item");for(let i=0;i<accordions.length;i++){this.accordions.push(new Accordion(this,accordions[i]));this.accordions[i].setForm(new forms[i](this.accordions[i]))}}next(action){if(action){if(this.accordionPosition<this.accordions.length-1){this.accordionPosition++;this.accordions[this.accordionPosition].head.disabled=!action}}else{if(this.accordionPosition>0){this.accordions[this.accordionPosition].head.disabled=!action;this.accordionPosition--}}}}class SubmitElement{constructor(controller){this.controller=controller;this.element=document.querySelector('button[type="submit"');this.loader=document.getElementById("submitLoader");this.handler=new HandleSubmit(this,controller);this.init()}init(){this.listener()}callback(e){e.preventDefault();this.handler.callback()}listener(){this.element.addEventListener("click",e=>{this.callback(e)})}}class Accordion{constructor(controller,element){this.controller=controller;this.element=element;this.head=this.element.children[0].children[0];this.form=null;this.state=false}click(){this.head.click()}valid(action){if(action)this.head.classList.add("validForm");else this.head.classList.remove("validForm");this.controller.next(action)}"default"(){this.head.classList.remove("validForm");this.controller.next(false)}setForm(form){this.form=form}}class Wallet{constructor(controller){this.controller=controller;this.clients=[];this.container=document.getElementById("walletContainer")}init(clientObject){this.clients.push(clientObject);this.render(this.clients[this.clients.length-1].user_name)}callback(event){let id=event.target.id;let walletItem=document.getElementById(id);if(walletItem){walletItem.parentNode.parentNode.removeChild(walletItem.parentNode)}let name=id.split("-")[1];this.update(name);this.controller.addSwitch();this.controller.callbackValidationData(null)}render(name){let id=`member-${name}`;let html=`
            <div class="walletItem">
                <span style="width: 90%;">${name}</span>
                <button id="${id}" type="button" class="btn-close" aria-label="Tancar"></button>
            </div>
        `;this.container.insertAdjacentHTML("beforeend",html);this.listener(id)}listener(elementId){document.getElementById(elementId).addEventListener("click",e=>{this.callback(e)})}"default"(){this.clients=[];this.container.innerHTML=""}update(userName){this.clients=this.clients.filter(objeto=>objeto.user_name!==userName);this.controller.value.miembros=this.controller.value.miembros.filter(objeto=>objeto.user_name!==userName)}}class FormQuota{constructor(controller){this.controller=controller;this.inputs=document.querySelectorAll('input[name="user_share"');this.value=null;this.init()}init(){this.listener()}callback(inputIndex){if(this.value==null){this.value=this.inputs[inputIndex].value;this.controller.valid(true)}if(this.inputs[inputIndex].value=="Grup"){this.controller.controller.accordions[2].form.setForm(1)}else{this.controller.controller.accordions[2].form.setForm(0)}}listener(){for(let i=0;i<this.inputs.length;i++){this.inputs[i].addEventListener("change",()=>{this.callback(i)})}}}class FormInfoQuota{constructor(controller){this.controller=controller;this.inputs=[document.querySelector('input[name="sub_email"'),document.querySelector('input[name="sub_phone"')];this.value={sub_email:null,sub_phone:null};this.next=false;this.init()}init(){this.listener()}callback(inputIndex,inputvalue){if(inputIndex==0){if(this.validarEmail(inputvalue)){this.value.sub_email=inputvalue;this.renderValidation(inputIndex,true)}else{this.value.sub_email=null;this.renderValidation(inputIndex,false)}}else if(inputIndex==1){if(this.validarNumero(inputvalue)){this.value.sub_phone=inputvalue;this.renderValidation(inputIndex,true)}else{this.value.sub_phone=null;this.renderValidation(inputIndex,false)}}if(this.value.sub_email!=null&&this.value.sub_phone!=null){if(!this.next){this.controller.valid(true);this.next=true}}else{if(this.next){this.controller["default"]();this.next=false}}}listener(){for(let i=0;i<this.inputs.length;i++){this.inputs[i].addEventListener("keyup",()=>{this.callback(i,this.inputs[i].value)})}}renderValidation(inputIndex,action){if(action){this.inputs[inputIndex].classList.add("is-valid")}else{this.inputs[inputIndex].classList.remove("is-valid")}}validarEmail(email){const regexEmail=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return regexEmail.test(email)}validarNumero(numeroTelefono){const regexNumeros=/\d/g;const numerosEncontrados=numeroTelefono.match(regexNumeros);return numerosEncontrados&&numerosEncontrados.length>=6}}class FormDatosPersonales{constructor(controller){this.controller=controller;this.container=document.getElementById("userPersonalData");this.forms=[new SingleUser(this),new MultiUser(this)];this.form=null;this.value=null;this.next=false}callback(action){if(action){if(!this.next){this.controller.valid(true);this.next=true}}else{if(this.next){this.controller["default"]();this.next=false}}}setForm(indexForms){if(indexForms==0){document.getElementById("multi-user").style.display="none";document.getElementById("single-user").style.display="block"}else if(indexForms==1){document.getElementById("multi-user").style.display="block";document.getElementById("single-user").style.display="none"}try{this.form["default"]()}catch{}this.form=this.forms[indexForms]}}class SingleUser{constructor(controller,inputs=[document.querySelector('input[name="user_name"'),document.querySelector('input[name="user_instrument"'),document.querySelector('input[name="user_foto"'),document.querySelector('input[name="user_pasport"')]){this.controller=controller;this.previewImages=[document.getElementById("previewFoto").src,document.getElementById("previewPasport").src];this.inputs=inputs;this.value={user_name:null,user_instrument:null,user_foto:null,user_pasport:null};this.init()}init(){this.listener()}callback(inputIndex){switch(inputIndex){case 0:if(this.validName(this.inputs[inputIndex].value))this.value.user_name=this.inputs[inputIndex].value,this.inputs[inputIndex].classList.add("is-valid");else this.value.user_name=null,this.inputs[inputIndex].classList.remove("is-valid");break;case 1:if(this.validInstrument(this.inputs[inputIndex].value))this.value.user_instrument=this.inputs[inputIndex].value,this.inputs[inputIndex].classList.add("is-valid");else this.value.user_instrument=null,this.inputs[inputIndex].classList.remove("is-valid");break;case 2:if(this.validImage(this.inputs[inputIndex]))this.value.user_foto=this.imageToData(this.inputs[inputIndex]),this.inputs[inputIndex].classList.add("is-valid");else this.value.user_foto=null,this.inputs[inputIndex].classList.remove("is-valid");break;case 3:if(this.validImage(this.inputs[inputIndex]))this.value.user_pasport=this.imageToData(this.inputs[inputIndex]),this.inputs[inputIndex].classList.add("is-valid");else this.value.user_pasport=null,this.inputs[inputIndex].classList.remove("is-valid");break}let isValid=this.verifyDataNulls(this.value);if(isValid){this.controller.callback(true)}else{this.controller.callback(false)}}listener(){for(let i=0;i<this.inputs.length;i++){if(this.inputs[i].type=="file"){this.inputs[i].addEventListener("change",()=>{this.callback(i)})}else{this.inputs[i].addEventListener("keyup",()=>{this.callback(i)})}}}validName(value){value=value.trim();var spaces=value.split(" ").length-1;return spaces>=1}validInstrument(value){var response=value.trim();return response!==""}validImage(inputFile){return inputFile.files&&inputFile.files.length>0}imageToData(inputFile){var archivoSeleccionado=inputFile.files[0];if(archivoSeleccionado){var lector=new FileReader;lector.onload=evento=>{var datosDeImagen=evento.target.result;let imageData={nombre:archivoSeleccionado.name,tipo:archivoSeleccionado.type,contenido:datosDeImagen};this.value[inputFile.id]=imageData;this.callback(null)};lector.readAsDataURL(archivoSeleccionado)}}verifyDataNulls(data){for(const clave in data){if(data.hasOwnProperty(clave)){if(data[clave]===null){return false}}}return true}"default"(){for(let i=0;i<this.inputs.length;i++){this.inputs[i].value="";this.inputs[i].classList.remove("is-valid")}document.getElementById("previewFoto").src=this.previewImages[0];document.getElementById("previewPasport").src=this.previewImages[1];this.value={user_name:null,user_instrument:null,user_foto:null,user_pasport:null};this.controller.callback(false)}}class MultiUser{constructor(controller){this.controller=controller;this.wallet=new Wallet(this);this.addBtn=document.getElementById("addBtn");this.maxMembers=6;this.value={grupo_nombre:null,grupo_logo:null,miembros:[]};this.previewImages=[document.getElementById("previewFotoMember").src,document.getElementById("previewPasportMember").src];this.previewLogo=document.getElementById("previewLogo").src;this.closeBtn=[document.getElementById("closeModalMember"),document.getElementById("closeModalUp")];this.saveBtn=document.getElementById("saveModalMemder");this.inputsSingle=[document.querySelector('input[name="member_name"'),document.querySelector('input[name="member_instrument"'),document.querySelector('input[name="member_foto"'),document.querySelector('input[name="member_pasport"')];this.inputs=[document.getElementById("grupo_name"),document.getElementById("grupo_logo")];this.userFormController=new SingleUser(this,this.inputsSingle);this.init()}init(){this.listener()}callback(action){if(action)this.saveBtn.disabled=false;else this.saveBtn.disabled=true}callbackValidationData(inputIndex){switch(inputIndex){case 0:if(this.inputs[inputIndex].value.length>0)this.value.grupo_nombre=this.inputs[inputIndex].value,this.inputs[inputIndex].classList.add("is-valid");else this.inputs[inputIndex].classList.remove("is-valid");break;case 1:if(this.userFormController.validImage(this.inputs[inputIndex]))this.value.grupo_logo=this.imageToData(this.inputs[inputIndex]),this.inputs[inputIndex].classList.add("is-valid");else this.value.user_foto=null,this.inputs[inputIndex].classList.remove("is-valid");break}if(this.value.grupo_nombre!=null&&this.value.grupo_logo!=null&&this.value.miembros.length>0&&this.value.miembros.length<=this.maxMembers){this.controller.callback(true)}else{this.controller.callback(false)}}callbackSave(){if(this.value.miembros.length<this.maxMembers){this.wallet.init(this.userFormController.value);this.value.miembros.push(this.userFormController.value);this.callbackValidationData(null)}else{alert("No es pot afegir més membre.Si està experimentant un error, si us plau refresqui la pàgina.Disculpi les molèsties.")}this.addSwitch();this.callbackClose();this.closeBtn[0].click()}addSwitch(){if(this.value.miembros.length==this.maxMembers){this.addBtn.disabled=true;this.addBtn.ariaDisabled=true}else{this.addBtn.disabled=false;this.addBtn.ariaDisabled=false}}callbackClose(){for(let i=0;i<this.inputsSingle.length;i++){this.inputsSingle[i].value="";this.inputsSingle[i].classList.remove("is-valid")}document.getElementById("previewFotoMember").src=this.previewImages[0];document.getElementById("previewPasportMember").src=this.previewImages[1];this.userFormController.value={user_name:null,user_instrument:null,user_foto:null,user_pasport:null};this.saveBtn.disabled=true}listener(){for(let i=0;i<this.closeBtn.length;i++){this.closeBtn[i].addEventListener("click",this.callbackClose.bind(this))}this.saveBtn.addEventListener("click",this.callbackSave.bind(this));for(let i=0;i<this.inputs.length;i++){if(this.inputs[i].type=="file")this.inputs[i].addEventListener("change",e=>{this.callbackValidationData(i)});else this.inputs[i].addEventListener("keyup",e=>{this.callbackValidationData(i)})}}"default"(){for(let i=0;i<this.inputs.length;i++){this.inputs[i].value="";this.inputs[i].classList.remove("is-valid")}document.getElementById("previewLogo").src=this.previewLogo;this.wallet["default"]();this.callbackClose();this.value={grupo_logo:null,grupo_nombre:null,miembros:[]};this.addBtn.disabled=false;this.addBtn.ariaDisabled=false;this.controller.callback(false)}imageToData(inputFile){var archivoSeleccionado=inputFile.files[0];if(archivoSeleccionado){var lector=new FileReader;lector.onload=evento=>{var datosDeImagen=evento.target.result;let imageData={nombre:archivoSeleccionado.name,tipo:archivoSeleccionado.type,contenido:datosDeImagen};this.value[inputFile.id]=imageData;this.callbackValidationData(null)};lector.readAsDataURL(archivoSeleccionado)}}}class FormBigData{constructor(controller){this.controller=controller;this.next=false;this.skipBtn=document.getElementById("btnSkip");this.inputs=[document.querySelector('input[name="bd-1"]'),document.querySelectorAll('input[name="bd-2"]'),document.querySelectorAll('input[name="bd-3"]'),document.querySelectorAll('input[name="bd-4"]'),document.querySelectorAll('input[name="bd-5"]'),document.querySelector('textarea[name="bd-6"]')];this.value=[{q:"Amb quin estil de música estàs més familiaritzat?",a:null},{q:"Has rebut beques o subvencions per financiar la teva professió musical?",a:null},{q:"Et dediques o t'has dedicat professionalment a la música?",a:null},{q:"Et resulta complicat trobar oportunitats laborals?",a:null},{q:"Quines estratègies utilitzes per a promocionar-te?",a:[]},{q:"Tens algún projecte en aquest moment? Podríes descriure'l breument?",a:null}];this.init()}init(){this.listener()}callback(){if(!this.next){this.controller.valid(true);this.next=true}}skip(){document.getElementById("skipAction").click()}valid(inputIndex){}getData(event){let question=event.target.name.split("-")[1]-1;if(question==4){if(event.target.checked){this.value[question].a.push(event.target.value)}else{let indexToDelete=this.value[question].a.indexOf(event.target.value);if(indexToDelete!==-1){this.value[question].a.splice(indexToDelete,1)}}}else{this.value[question].a=event.target.value}}listener(){this.controller.head.addEventListener("click",this.callback.bind(this));this.skipBtn.addEventListener("click",this.skip.bind(this));this.inputs[0].addEventListener("keyup",e=>this.getData(e));for(let i=0;i<this.inputs[1].length;i++){this.inputs[1][i].addEventListener("change",e=>this.getData(e))}for(let i=0;i<this.inputs[2].length;i++){this.inputs[2][i].addEventListener("change",e=>this.getData(e))}for(let i=0;i<this.inputs[3].length;i++){this.inputs[3][i].addEventListener("change",e=>this.getData(e))}for(let i=0;i<this.inputs[4].length;i++){this.inputs[4][i].addEventListener("change",e=>this.getData(e))}this.inputs[5].addEventListener("keyup",e=>this.getData(e))}}class FormPayment{constructor(controller){this.controller=controller;this.value=null;this.next=false;this.inputs=document.querySelectorAll('input[name="user_payment"]');this.init()}init(){this.listener()}callback(event){if(!this.next){this.value=event.target.value;this.next=true;this.controller.valid(true)}}listener(){for(let i=0;i<this.inputs.length;i++){this.inputs[i].addEventListener("click",e=>{this.callback(e)})}}}class FormPolicy{constructor(controller){this.controller=controller;this.inputs=[document.querySelector('input[name="policy"]'),document.querySelector('input[name="info"]'),document.querySelector('input[name="boletin"]')];this.value={bolleti:null,csrf_token:document.querySelector('input[name="csrf_token"]').value};this.init()}init(){this.listener()}callback(inputIndex){if(this.inputs[0].checked&&this.inputs[1].checked){this.controller.controller.submitElement.element.disabled=false;this.controller.valid(true)}else{this.controller.controller.submitElement.element.disabled=true}if(this.inputs[2].checked)this.value.bolleti=true;else this.value.bolleti=false}listener(){this.inputs[0].addEventListener("change",e=>{this.callback(e)});this.inputs[1].addEventListener("change",e=>{this.callback(e)})}}class HandleSubmit{constructor(controller,mainControler){this.controller=mainControler;this.parentControler=controller;this.url="http://192.168.50.225/api/subscripcions.php";this.dataModel={csrf_toke:null,subscripcion:{tarifa:null,correo:null,telefono:null,metodoPago:null,boletin:null},grupo:null,usuarios:{},bigData:null}}getData(){let data={csrf_token:this.controller.accordions[5].form.value.csrf_token,subscripcion:{tarifa:this.controller.accordions[0].form.value,correo:this.controller.accordions[1].form.value.sub_email,telefono:this.controller.accordions[1].form.value.sub_phone,metodoPago:this.controller.accordions[4].form.value,boletin:this.controller.accordions[5].form.value.bolleti},grupo:null,bigData:this.controller.accordions[3].form.value};if(this.controller?.accordions?.[2]?.form?.form?.wallet!==undefined){data["grupo"]={nombre:this.controller.accordions[2].form.form.value.grupo_nombre,imagen:this.controller.accordions[2].form.form.value.grupo_logo};data["usuarios"]=this.controller.accordions[2].form.form.value.miembros}else{data["usuarios"]=this.controller.accordions[2].form.form.value}return data}async sendData(data){try{const response=await fetch(this.url,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(data)});if(!response.ok){return{error:true,mensaje:new Error("Error al enviar la solicitud")}}const responseData=await response.json();return responseData}catch(error){return{error:true,mensaje:error}}}renderLoad(state){if(state){this.parentControler.element.style.display="none";this.parentControler.loader.style.display="block"}else{this.parentControler.element.style.display="block";this.parentControler.loader.style.display="none"}}renderResponse(response,account=null){if(!response.error){let form=document.getElementById("formulari-inscripcio");let toast=document.getElementById("responseSuccess");let message=document.getElementById("responseSuccesMessage");form.style.display="none";message.textContent=account;toast.classList.add("show")}else{let form=document.getElementById("formulari-inscripcio");let toast=document.getElementById("responseError");let message=document.getElementById("responseErrorMessage");message.textContent=response.mensaje;toast.classList.add("show")}}async callback(){this.renderLoad(true);let data=this.getData();let response=await this.sendData(data);this.renderLoad(false);this.renderResponse(response,data.subscripcion.correo)}}var forms=[FormQuota,FormInfoQuota,FormDatosPersonales,FormBigData,FormPayment,FormPolicy];let FormApp=new FormController;